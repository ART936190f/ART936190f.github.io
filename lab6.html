<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <title>–ö–∞—Ä—Ç–∞ –°—Ç–æ—É–Ω—Ö–µ–Ω–¥–∂–∞ —Ç–∞ –ú–∞—Ä—à—Ä—É—Ç–∏</title>

    <link rel="stylesheet" href="https://atlas.microsoft.com/sdk/javascript/mapcontrol/3/atlas.min.css" type="text/css" />
    <script src="https://atlas.microsoft.com/sdk/javascript/mapcontrol/3/atlas.min.js"></script>

    <script src="https://atlas.microsoft.com/sdk/javascript/service/2/atlas-service.min.js"></script>

    <style>
        /* –°—Ç–∏–ª—ñ –¥–ª—è –ø–æ–≤–Ω–æ–µ–∫—Ä–∞–Ω–Ω–æ—ó –∫–∞—Ä—Ç–∏ */
        html, body {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            font-family: Arial, sans-serif;
        }
        #myMap {
            width: 100%;
            height: 60vh; /* –ö–∞—Ä—Ç–∞ –∑–∞–π–º–∞—Ç–∏–º–µ 60% –≤–∏—Å–æ—Ç–∏ –≤—ñ–∫–Ω–∞ */
        }
        #panoContainer {
            width: 100%;
            height: 40vh; /* –ü–∞–Ω–æ—Ä–∞–º–∞ –∑–∞–π–º–∞—Ç–∏–º–µ 40% –≤–∏—Å–æ—Ç–∏ –≤—ñ–∫–Ω–∞ */
            border-top: 2px solid #ccc;
            box-sizing: border-box;
            padding: 10px;
            overflow: hidden; /* –ó–∞–±–µ–∑–ø–µ—á–µ–Ω–Ω—è, —â–æ iframe –Ω–µ –≤–∏—Ö–æ–¥–∏—Ç—å –∑–∞ –º–µ–∂—ñ */
        }
        #panoContainer iframe {
            height: calc(100% - 30px); /* –í—Ä–∞—Ö—É–≤–∞–Ω–Ω—è –∑–∞–≥–æ–ª–æ–≤–∫–∞ */
            display: block;
        }
        .route-info {
            padding: 10px;
            background-color: #f0f0f0;
            border-bottom: 1px solid #ccc;
            font-size: 0.9em;
        }
    </style>
</head>
<body onload="InitMap()">
    <h1>–°—Ç–æ—É–Ω—Ö–µ–Ω–¥–∂ —Ç–∞ –ú–∞—Ä—à—Ä—É—Ç–∏</h1>
    <div id="routeTimeInfo" class="route-info">
        –ó–∞—á–µ–∫–∞–π—Ç–µ, —Ä–æ–∑—Ä–∞—Ö–æ–≤—É—é—Ç—å—Å—è –º–∞—Ä—à—Ä—É—Ç–∏...
    </div>
    <div id="myMap"></div>
    
    <div id="panoContainer">
        <h2>–ü–∞–Ω–æ—Ä–∞–º–Ω–∏–π –ø–µ—Ä–µ–≥–ª—è–¥ (Google Street View)</h2>
        <iframe
            width="100%"
            height="100%"
            frameborder="0" style="border:0"
            src="https://www.google.com/maps/embed?pb=!3m2!1suk!2sua!4v1761065304977!5m2!1suk!2sua!6m8!1m7!1sCAoSFkNJSE0wb2dLRUlDQWdJRG13b3FlUFE.!2m2!1d51.17843307511775!2d-1.826001340014652!3f357.315239888935!4f-21.49353908800488!5f0.7820865974627469" 
            allowfullscreen
            referrerpolicy="no-referrer-when-downgrade">
        </iframe>
    </div>

    <script>
        // *** –£–í–ê–ì–ê: –ó–∞–º—ñ–Ω—ñ—Ç—å —Ü–µ–π –∫–ª—é—á –Ω–∞ –≤–∞—à —Å–ø—Ä–∞–≤–∂–Ω—ñ–π –∫–ª—é—á –ø—ñ–¥–ø–∏—Å–∫–∏ Azure Maps ***
        const subscriptionKey = '3pk8sSL7JavoYHPg12dqZD9501gAE1p6bCH81oCILxLLRtBERj0BJQQJ99BJACYeBjFpcYJpAAAgAZMP1mBn';
        let map;
        let routeDataSource;
        const stonehengeCoords = [-1.8262, 51.1789]; // [–¥–æ–≤–≥–æ—Ç–∞, —à–∏—Ä–æ—Ç–∞]

        // –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏ –¥–ª—è –Ω–æ–≤–∏—Ö –º–∞—Ä—à—Ä—É—Ç—ñ–≤
        const salisburyCoords = [-1.7945, 51.0694]; // –°–æ–ª—Å–±–µ—Ä—ñ (–Ω–∞–π–±–ª–∏–∂—á–µ –º—ñ—Å—Ç–æ)
        const londonCoords = [-0.1278, 51.5074]; // –õ–æ–Ω–¥–æ–Ω (—Ü–µ–Ω—Ç—Ä)

        // –î–æ–¥–∞—Ç–∫–æ–≤–µ –¥–∂–µ—Ä–µ–ª–æ –¥–∞–Ω–∏—Ö –¥–ª—è –¥—Ä—É–≥–æ–≥–æ –º–∞—Ä—à—Ä—É—Ç—É (—â–æ–± –º–æ–∂–Ω–∞ –±—É–ª–æ —ó—Ö —Ä–æ–∑—Ä—ñ–∑–Ω—è—Ç–∏)
        let routeDataSource2; 

        function InitMap() {
            // 1. –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –∫–∞—Ä—Ç–∏ —Ç–∞ –∑–º—ñ–Ω–∞ —Å—Ç–∏–ª—é
            map = new atlas.Map('myMap', {
                center: stonehengeCoords, 
                zoom: 10, // –ó–º–µ–Ω—à–∏–ª–∏ –∑—É–º, —â–æ–± –±–∞—á–∏—Ç–∏ –º–∞—Ä—à—Ä—É—Ç–∏
                view: 'Auto',
                style: 'satellite_road_labels', 

                authOptions: {
                    authType: 'subscriptionKey',
                    subscriptionKey: subscriptionKey
                }
            });

            // –û—á—ñ–∫—É–≤–∞–Ω–Ω—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ä–µ—Å—É—Ä—Å—ñ–≤ –∫–∞—Ä—Ç–∏
            map.events.add('ready', function () {
                
                // –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –¥–∂–µ—Ä–µ–ª –¥–∞–Ω–∏—Ö –¥–ª—è –º–∞—Ä—à—Ä—É—Ç—ñ–≤
                routeDataSource = new atlas.source.DataSource(); // –ú–∞—Ä—à—Ä—É—Ç –¥–æ –°–æ–ª—Å–±–µ—Ä—ñ (–±—É–≤ –¥–æ –¢—É—Ä. —Ü–µ–Ω—Ç—Ä—É)
                routeDataSource2 = new atlas.source.DataSource(); // –ú–∞—Ä—à—Ä—É—Ç –¥–æ –õ–æ–Ω–¥–æ–Ω–∞

                map.sources.add(routeDataSource);
                map.sources.add(routeDataSource2);

                // –î–æ–¥–∞–≤–∞–Ω–Ω—è –º—ñ—Ç–æ–∫ (–º–∞—Ä–∫–µ—Ä—ñ–≤)
                addMarkers();

                // –ü—Ä–æ–∫–ª–∞–¥–∞–Ω–Ω—è –º–∞—Ä—à—Ä—É—Ç—ñ–≤
                calculateAndDisplayRoute('Salisbury', salisburyCoords, 'blue');
                calculateAndDisplayRoute('London', londonCoords, 'red');
                
                // –î–æ–¥–∞—Ç–∫–æ–≤—ñ –µ–ª–µ–º–µ–Ω—Ç–∏ –∫–µ—Ä—É–≤–∞–Ω–Ω—è
                map.controls.add(new atlas.control.ZoomControl(), { position: 'top-right' });
                map.controls.add(new atlas.control.StyleControl({
                    mapStyles: ['road', 'grayscale_dark', 'satellite', 'satellite_road_labels']
                }), { position: 'top-right' });
                
                // –û–±—Ä–æ–±–∫–∞ –≤–∏–ø–∞–¥–∫—ñ–≤, –∫–æ–ª–∏ –º–∞—Ä—à—Ä—É—Ç–∏ –≤–∂–µ —Ä–æ–∑—Ä–∞—Ö–æ–≤–∞–Ω—ñ
                // –ú–∏ –±—É–¥–µ–º–æ –º–∞—Å—à—Ç–∞–±—É–≤–∞—Ç–∏ –∫–∞—Ä—Ç—É –ø—ñ—Å–ª—è —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫—É –æ–±–æ—Ö –º–∞—Ä—à—Ä—É—Ç—ñ–≤.
            });
        }
        
        function addMarkers() {
            // –ú—ñ—Ç–∫–∞ 1: –°—Ç–æ—É–Ω—Ö–µ–Ω–¥–∂
            const marker1 = new atlas.HtmlMarker({
                color: 'red',
                text: 'üóø',
                position: stonehengeCoords,
                popup: new atlas.Popup({
                    content: '<div style="padding:10px;"><b>–°—Ç–æ—É–Ω—Ö–µ–Ω–¥–∂</b><br>–°—Ç–∞—Ä–æ–¥–∞–≤–Ω—ñ–π –ø–∞–º\'—è—Ç–Ω–∏–∫</div>',
                    pixelOffset: [0, -30]
                })
            });
            map.markers.add(marker1);
            map.events.add('click', marker1, () => {
                marker1.getPopup().toggle();
            });

            // –ú—ñ—Ç–∫–∞ 2: –°–æ–ª—Å–±–µ—Ä—ñ
            const marker2 = new atlas.HtmlMarker({
                color: 'blue',
                text: 'üè†',
                position: salisburyCoords,
                popup: new atlas.Popup({
                    content: '<div style="padding:10px;"><b>–°–æ–ª—Å–±–µ—Ä—ñ</b><br>–ù–∞–π–±–ª–∏–∂—á–µ –º—ñ—Å—Ç–æ</div>'
                })
            });
            map.markers.add(marker2);
            map.events.add('click', marker2, () => {
                marker2.getPopup().toggle();
            });
            
            // –ú—ñ—Ç–∫–∞ 3: –õ–æ–Ω–¥–æ–Ω
            const marker3 = new atlas.HtmlMarker({
                color: 'red',
                text: 'üèõÔ∏è',
                position: londonCoords,
                popup: new atlas.Popup({
                    content: '<div style="padding:10px;"><b>–õ–æ–Ω–¥–æ–Ω</b><br>–°—Ç–æ–ª–∏—Ü—è</div>'
                })
            });
            map.markers.add(marker3);
            map.events.add('click', marker3, () => {
                marker3.getPopup().toggle();
            });
        }

        let routesCalculated = 0; // –õ—ñ—á–∏–ª—å–Ω–∏–∫ –¥–ª—è –º–∞—Å—à—Ç–∞–±—É–≤–∞–Ω–Ω—è –ø—ñ—Å–ª—è —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫—É –æ–±–æ—Ö
        let totalBounds = null; // –ó–±–µ—Ä—ñ–≥–∞—Ç–∏–º–µ –∑–∞–≥–∞–ª—å–Ω—ñ –º–µ–∂—ñ –¥–ª—è –æ–±–æ—Ö –º–∞—Ä—à—Ä—É—Ç—ñ–≤

        function calculateAndDisplayRoute(destinationName, destinationCoords, color) {
            
            const startPoint = stonehengeCoords; // –°—Ç–æ—É–Ω—Ö–µ–Ω–¥–∂ —è–∫ –ø–æ—á–∞—Ç–∫–æ–≤–∞ —Ç–æ—á–∫–∞
            const endPoint = destinationCoords;

            const routeURL = 'https://atlas.microsoft.com/route/directions/json?api-version=1.0';
            const routeService = new atlas.service.RouteURL(new atlas.service.Aborter(), routeURL);

            const coordinates = [startPoint, endPoint];

            // –ü–∞—Ä–∞–º–µ—Ç—Ä–∏ –º–∞—Ä—à—Ä—É—Ç—É: travelMode=car (–ª–µ–≥–∫–æ–≤–∏–∫), routeType=fastest (–Ω–∞–π—à–≤–∏–¥—à–∏–π)
            const routeOptions = {
                travelMode: 'car',
                routeType: 'fastest',
                query: coordinates.join(':')
            };

            routeService.calculateRouteDirections(atlas.service.Aborter.timeout(10000), coordinates, routeOptions)
                .then(response => {
                    const data = response.geojson.features;
                    
                    // –û—Ç—Ä–∏–º–∞–Ω–Ω—è —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó –ø—Ä–æ –º–∞—Ä—à—Ä—É—Ç
                    const routeSummary = response.routes[0].summary;
                    const travelTimeSeconds = routeSummary.travelTimeInSeconds;
                    const travelTimeHours = Math.floor(travelTimeSeconds / 3600);
                    const travelTimeMinutes = Math.floor((travelTimeSeconds % 3600) / 60);

                    const timeString = `${travelTimeHours} –≥–æ–¥ ${travelTimeMinutes} —Ö–≤`;

                    // –û–Ω–æ–≤–ª–µ–Ω–Ω—è —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ–π–Ω–æ–≥–æ –±–ª–æ–∫—É
                    const infoDiv = document.getElementById('routeTimeInfo');
                    
                    if (routesCalculated === 0) {
                        infoDiv.innerHTML = '–ß–∞—Å —É –¥–æ—Ä–æ–∑—ñ –Ω–∞ –ª–µ–≥–∫–æ–≤–æ–º—É –∞–≤—Ç–æ–º–æ–±—ñ–ª—ñ: ';
                    }
                    
                    infoDiv.innerHTML += `<br>üöó –î–æ **${destinationName}** (${color === 'blue' ? '–°–∏–Ω—ñ–π' : '–ß–µ—Ä–≤–æ–Ω–∏–π' } –º–∞—Ä—à—Ä—É—Ç): **${timeString}**`;

                    // –î–æ–¥–∞–≤–∞–Ω–Ω—è GeoJSON –º–∞—Ä—à—Ä—É—Ç—É –¥–æ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–æ–≥–æ –¥–∂–µ—Ä–µ–ª–∞ –¥–∞–Ω–∏—Ö
                    const currentRouteDataSource = destinationName === 'London' ? routeDataSource2 : routeDataSource;
                    currentRouteDataSource.add(data);

                    // –°—Ç–≤–æ—Ä–µ–Ω–Ω—è —à–∞—Ä—É –ª—ñ–Ω—ñ—ó –¥–ª—è –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –º–∞—Ä—à—Ä—É—Ç—É
                    const routeLayer = new atlas.layer.LineLayer(currentRouteDataSource, null, {
                        strokeColor: color,
                        strokeWidth: 5,
                        lineJoin: 'round',
                        lineCap: 'round'
                    });

                    // –î–æ–¥–∞–≤–∞–Ω–Ω—è —à–∞—Ä—É –º–∞—Ä—à—Ä—É—Ç—É –Ω–∞ –∫–∞—Ä—Ç—É
                    map.layers.add(routeLayer);

                    // –û–±—á–∏—Å–ª–µ–Ω–Ω—è –∑–∞–≥–∞–ª—å–Ω–∏—Ö –º–µ–∂ –¥–ª—è –º–∞—Å—à—Ç–∞–±—É–≤–∞–Ω–Ω—è
                    const bounds = atlas.data.BoundingBox.fromData(data);
                    if (totalBounds) {
                        totalBounds = atlas.data.BoundingBox.merge(totalBounds, bounds);
                    } else {
                        totalBounds = bounds;
                    }

                    routesCalculated++;

                    // –ú–∞—Å—à—Ç–∞–±—É–≤–∞–Ω–Ω—è –∫–∞—Ä—Ç–∏ –¥–æ –æ–±–æ—Ö –º–∞—Ä—à—Ä—É—Ç—ñ–≤, –∫–æ–ª–∏ –æ–±–∏–¥–≤–∞ —Ä–æ–∑—Ä–∞—Ö–æ–≤–∞–Ω—ñ
                    if (routesCalculated === 2) {
                        map.setCamera({ bounds: totalBounds, padding: 50 });
                    }
                })
                .catch(error => {
                    console.error(`–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫—É –º–∞—Ä—à—Ä—É—Ç—É –¥–æ ${destinationName}:`, error);
                    document.getElementById('routeTimeInfo').innerHTML += `<br>‚ùå –ù–µ –≤–¥–∞–ª–æ—Å—è —Ä–æ–∑—Ä–∞—Ö—É–≤–∞—Ç–∏ –º–∞—Ä—à—Ä—É—Ç –¥–æ **${destinationName}**.`;
                    routesCalculated++;
                    if (routesCalculated === 2 && totalBounds) {
                        map.setCamera({ bounds: totalBounds, padding: 50 });
                    }
                });
        }
    </script>
</body>
</html>
