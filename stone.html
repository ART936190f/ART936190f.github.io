<!DOCTYPE html>
<html lang="uk">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <title>–ö–∞—Ä—Ç–∞ –°—Ç–æ—É–Ω—Ö–µ–Ω–¥–∂–∞ –Ω–∞ Azure Maps ‚Äî –º–∞—Ä—à—Ä—É—Ç–∏</title>

    <link rel="stylesheet" href="https://atlas.microsoft.com/sdk/javascript/mapcontrol/3/atlas.min.css" type="text/css" />
    <script src="https://atlas.microsoft.com/sdk/javascript/mapcontrol/3/atlas.min.js"></script>
    <script src="https://atlas.microsoft.com/sdk/javascript/service/2/atlas-service.min.js"></script>

    <style>
        /* –°—Ç–∏–ª—ñ –¥–ª—è –ø–æ–≤–Ω–æ–µ–∫—Ä–∞–Ω–Ω–æ—ó –∫–∞—Ä—Ç–∏ */
        html, body {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            font-family: Arial, sans-serif;
        }

        #myMap {
            width: 100%;
            height: 60vh; /* –ö–∞—Ä—Ç–∞ –∑–∞–π–º–∞—Ç–∏–º–µ 60% –≤–∏—Å–æ—Ç–∏ –≤—ñ–∫–Ω–∞ */
        }

        #panoContainer {
            width: 100%;
            height: 40vh; /* –ü–∞–Ω–æ—Ä–∞–º–∞ –∑–∞–π–º–∞—Ç–∏–º–µ 40% –≤–∏—Å–æ—Ç–∏ –≤—ñ–∫–Ω–∞ */
            border-top: 2px solid #ccc;
            box-sizing: border-box;
        }

        #infoPanel {
            position: absolute;
            left: 10px;
            top: 70px;
            z-index: 2000;
            background: rgba(255,255,255,0.95);
            padding: 10px;
            border-radius: 6px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.2);
            min-width: 220px;
            font-size: 14px;
        }

        #controls {
            position: absolute;
            left: 10px;
            top: 10px;
            z-index: 2000;
        }

        #controls button {
            margin-right: 6px;
            padding: 6px 10px;
            border-radius: 4px;
            border: 1px solid #ccc;
            background: #fff;
            cursor: pointer;
        }

        h2 { margin: 10px; }
    </style>
</head>

<body onload="InitMap()">
    <h1>–°—Ç–æ—É–Ω—Ö–µ–Ω–¥–∂ —Ç–∞ –æ–∫–æ–ª–∏—Ü—ñ (Azure Maps)</h1>
    <div id="controls">
        <button id="toggleAmesbury">–ü—Ä–∏—Ö–æ–≤–∞—Ç–∏ –º–∞—Ä—à—Ä—É—Ç –¥–æ –ï–π–º—Å–±–µ—Ä—ñ</button>
        <button id="toggleLondon">–ü—Ä–∏—Ö–æ–≤–∞—Ç–∏ –º–∞—Ä—à—Ä—É—Ç –¥–æ –õ–æ–Ω–¥–æ–Ω–∞</button>
    </div>

    <div id="myMap"></div>

    <div id="infoPanel">
        <strong>–Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ –º–∞—Ä—à—Ä—É—Ç–∏</strong>
        <div id="routesInfo">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...</div>
    </div>

    <div id="panoContainer">
        <h2>–ü–∞–Ω–æ—Ä–∞–º–Ω–∏–π –ø–µ—Ä–µ–≥–ª—è–¥ (Google Street View)</h2>
        <iframe
            width="100%"
            height="100%"
            frameborder="0" style="border:0"
            src="https://www.google.com/maps/embed?pb=!3m2!1suk!2sua!4v1761065304977!5m2!1suk!2sua!6m8!1m7!1sCAoSFkNJSE0wb2dLRUlDQWdJRG13b3FlUFE.!2m2!1d51.17843307511775!2d-1.826001340014652!3f357.315239888935!4f-21.49353908800488!5f0.7820865974627469"
            allowfullscreen
            referrerpolicy="no-referrer-when-downgrade">
        </iframe>
    </div>

    <script>
        // –£–í–ê–ì–ê: –ó–∞–º—ñ–Ω—ñ—Ç—å —Ü–µ–π –∫–ª—é—á –Ω–∞ –≤–∞—à –¥—ñ–π—Å–Ω–∏–π –∫–ª—é—á Azure Maps.
        const subscriptionKey = '3pk8sSL7JavoYHPg12dqZD9501gAE1p6bCH81oCILxLLRtBERj0BJQQJ99BJACYeBjFpcYJpAAAgAZMP1mBn';

        let map;
        let datasource;
        let routeDataSource;
        let popup;

        // –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏ –°—Ç–æ—É–Ω—Ö–µ–Ω–¥–∂–∞: [–¥–æ–≤–≥–æ—Ç–∞, —à–∏—Ä–æ—Ç–∞]
        const stonehengeCoords = [-1.8262, 51.1789];
        // –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏ –ï–π–º—Å–±–µ—Ä—ñ (–Ω–∞–π–±–ª–∏–∂—á–µ –º—ñ—Å—Ç–æ): [–¥–æ–≤–≥–æ—Ç–∞, —à–∏—Ä–æ—Ç–∞]
        const amesburyCoords = [-1.789, 51.176];
        // –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏ –õ–æ–Ω–¥–æ–Ω–∞: [–¥–æ–≤–≥–æ—Ç–∞, —à–∏—Ä–æ—Ç–∞]
        const londonCoords = [-0.1278, 51.5074];

        // –©–æ–± –º–∏ –º–æ–≥–ª–∏ –≤–º–∏–∫–∞—Ç–∏/–≤–∏–º–∏–∫–∞—Ç–∏ –æ–∫—Ä–µ–º—ñ –º–∞—Ä—à—Ä—É—Ç–∏
        const visibleRoutes = {
            toAmesbury: true,
            toLondon: true
        };

        function InitMap() {
            // 1. –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –∫–∞—Ä—Ç–∏ —Ç–∞ –∑–º—ñ–Ω–∞ —Å—Ç–∏–ª—é
            map = new atlas.Map('myMap', {
                center: stonehengeCoords,
                zoom: 10, // –ó–º–µ–Ω—à–µ–Ω–æ –∑—É–º, —â–æ–± –±–∞—á–∏—Ç–∏ –æ–±–∏–¥–≤–∞ –º–∞—Ä—à—Ä—É—Ç–∏
                style: 'satellite_road_labels',
                authOptions: {
                    authType: 'subscriptionKey',
                    subscriptionKey: subscriptionKey
                }
            });

            map.events.add('ready', function () {
                // –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –¥–∂–µ—Ä–µ–ª –¥–∞–Ω–∏—Ö
                datasource = new atlas.source.DataSource();
                map.sources.add(datasource);

                routeDataSource = new atlas.source.DataSource();
                map.sources.add(routeDataSource);

                // –°—Ç–≤–æ—Ä–µ–Ω–Ω—è —à–∞—Ä—É –ª—ñ–Ω—ñ—ó –¥–ª—è –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –º–∞—Ä—à—Ä—É—Ç—É
                const routeLayer = new atlas.layer.LineLayer(routeDataSource, null, {
                    strokeWidth: 5,
                    lineJoin: 'round',
                    lineCap: 'round',
                    strokeColor: ['match', ['get', 'routeId'],
                        'toAmesbury', 'darkgreen',
                        'toLondon', 'red',
                        'black'
                    ]
                });
                map.layers.add(routeLayer);

                // –Ñ–¥–∏–Ω–µ —Å–ø–ª–∏–≤–∞—é—á–µ –≤—ñ–∫–Ω–æ (—è–∫–µ –º–∏ –±—É–¥–µ–º–æ –æ–Ω–æ–≤–ª—é–≤–∞—Ç–∏)
                popup = new atlas.Popup({
                    content: '',
                    position: stonehengeCoords
                });

                // 2. –î–æ–¥–∞–≤–∞–Ω–Ω—è –º—ñ—Ç–æ–∫ (–º–∞—Ä–∫–µ—Ä—ñ–≤)
                addMarkers();

                // 3. –ü—Ä–æ–∫–ª–∞–¥–∞–Ω–Ω—è –º–∞—Ä—à—Ä—É—Ç—ñ–≤
                // –ú–∏ –∑–±–µ—Ä—ñ–≥–∞—Ç–∏–º–µ–º–æ –æ–±'—î–∫—Ç–∏ –º–∞—Ä—à—Ä—É—Ç—ñ–≤, —â–æ–± –ø–æ—Ç—ñ–º –º–æ–∂–Ω–∞ –±—É–ª–æ –ø–æ–∫–∞–∑—É–≤–∞—Ç–∏/—Ö–æ–≤–∞—Ç–∏
                calculateAndDisplayRoute(stonehengeCoords, amesburyCoords, 'toAmesbury', '–ï–π–º—Å–±–µ—Ä—ñ (–ù–∞–π–±–ª–∏–∂—á–µ –º—ñ—Å—Ç–æ)');
                calculateAndDisplayRoute(stonehengeCoords, londonCoords, 'toLondon', '–õ–æ–Ω–¥–æ–Ω');

                // 4. –î–æ–¥–∞—Ç–∫–æ–≤—ñ –µ–ª–µ–º–µ–Ω—Ç–∏ –∫–µ—Ä—É–≤–∞–Ω–Ω—è
                map.controls.add(new atlas.control.ZoomControl(), { position: 'top-right' });
                map.controls.add(new atlas.control.StyleControl({
                    mapStyles: ['road', 'grayscale_dark', 'satellite', 'satellite_road_labels', 'night']
                }), { position: 'top-right' });

                // –ö–Ω–æ–ø–∫–∏ –¥–ª—è –ø—Ä–∏—Ö–æ–≤—É–≤–∞–Ω–Ω—è/–ø–æ–∫–∞–∑—É –º–∞—Ä—à—Ä—É—Ç—É
                document.getElementById('toggleAmesbury').addEventListener('click', function () {
                    visibleRoutes.toAmesbury = !visibleRoutes.toAmesbury;
                    updateRoutesVisibility();
                    this.textContent = (visibleRoutes.toAmesbury ? '–ü—Ä–∏—Ö–æ–≤–∞—Ç–∏ –º–∞—Ä—à—Ä—É—Ç –¥–æ –ï–π–º—Å–±–µ—Ä—ñ' : '–ü–æ–∫–∞–∑–∞—Ç–∏ –º–∞—Ä—à—Ä—É—Ç –¥–æ –ï–π–º—Å–±–µ—Ä—ñ');
                });
                document.getElementById('toggleLondon').addEventListener('click', function () {
                    visibleRoutes.toLondon = !visibleRoutes.toLondon;
                    updateRoutesVisibility();
                    this.textContent = (visibleRoutes.toLondon ? '–ü—Ä–∏—Ö–æ–≤–∞—Ç–∏ –º–∞—Ä—à—Ä—É—Ç –¥–æ –õ–æ–Ω–¥–æ–Ω–∞' : '–ü–æ–∫–∞–∑–∞—Ç–∏ –º–∞—Ä—à—Ä—É—Ç –¥–æ –õ–æ–Ω–¥–æ–Ω–∞');
                });

            });
        }

        function addMarkers() {
            // –ú—ñ—Ç–∫–∞ 1: –°—Ç–æ—É–Ω—Ö–µ–Ω–¥–∂
            const markerStonehenge = new atlas.HtmlMarker({
                color: 'yellow',
                text: 'üóø',
                position: stonehengeCoords
            });
            map.markers.add(markerStonehenge);

            // –û–∫—Ä–µ–º–∏–π –ø–æ–ø–∞–ø –¥–ª—è –°—Ç–æ—É–Ω—Ö–µ–Ω–¥–∂–∞ (—â–æ–± –ø–æ–∫–∞–∑—É–≤–∞—Ç–∏ –≤—Å—ñ –º–∞—Ä—à—Ä—É—Ç–∏ —Ç–∞ —á–∞—Å)
            markerStonehenge.getPopup = function () {
                return popup;
            };

            map.events.add('click', markerStonehenge, () => { popup.toggle(); });

            // –ú—ñ—Ç–∫–∞ 2: –ï–π–º—Å–±–µ—Ä—ñ
            const markerAmesbury = new atlas.HtmlMarker({
                color: 'darkgreen',
                text: 'A',
                position: amesburyCoords,
                popup: new atlas.Popup({ content: '<div style="padding:10px;"><b>–ï–π–º—Å–±–µ—Ä—ñ</b></div>' })
            });
            map.markers.add(markerAmesbury);

            // –ú—ñ—Ç–∫–∞ 3: –õ–æ–Ω–¥–æ–Ω
            const markerLondon = new atlas.HtmlMarker({
                color: 'red',
                text: 'L',
                position: londonCoords,
                popup: new atlas.Popup({ content: '<div style="padding:10px;"><b>–õ–æ–Ω–¥–æ–Ω</b></div>' })
            });
            map.markers.add(markerLondon);
        }

        // –ó–±–µ—Ä—ñ–≥–∞—î–º–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏ –º–∞—Ä—à—Ä—É—Ç—ñ–≤ —Ç—É—Ç
        const routeResults = {};

        /**
         * –†–æ–∑—Ä–∞—Ö–æ–≤—É—î —Ç–∞ –≤—ñ–¥–æ–±—Ä–∞–∂–∞—î –º–∞—Ä—à—Ä—É—Ç –º—ñ–∂ –¥–≤–æ–º–∞ —Ç–æ—á–∫–∞–º–∏.
         */
        function calculateAndDisplayRoute(startPoint, endPoint, routeId, destinationName) {
            // –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ –∫–ª–∞—Å —Å–µ—Ä–≤—ñ—Å—É RouteURL –∑ SDK (—è–∫ —É –ø—Ä–∏–∫–ª–∞–¥—ñ Azure Maps)
            const routeService = new atlas.service.RouteURL(new atlas.service.Aborter(), subscriptionKey);

            // –ü–∞—Ä–∞–º–µ—Ç—Ä–∏ –∑–∞–ø–∏—Ç—É ‚Äî –ø–µ—Ä–µ–¥–∞—î–º–æ –º–∞—Å–∏–≤ —Ç–æ—á–æ–∫ —É –≤–∏–≥–ª—è–¥—ñ [[lon,lat], [lon,lat]]
            routeService.calculateRouteDirections(atlas.service.Aborter.timeout(10000), [startPoint, endPoint], {
                travelMode: 'car'
            })
            .then(response => {
                // –†–µ–∑—É–ª—å—Ç–∞—Ç —É response
                const data = response.geojson.features || [];
                const route = response.routes && response.routes[0];

                if (!route) {
                    throw new Error('–ú–∞—Ä—à—Ä—É—Ç –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ');
                }

                // –û—Ç—Ä–∏–º–∞–Ω–Ω—è —á–∞—Å—É –ø–æ—ó–∑–¥–∫–∏ –≤ —Å–µ–∫—É–Ω–¥–∞—Ö —Ç–∞ –¥–æ–≤–∂–∏–Ω–∏ –≤ –º–µ—Ç—Ä–∞—Ö (summary)
                const travelTimeSeconds = route.summary && route.summary.travelTimeInSeconds ? route.summary.travelTimeInSeconds : null;
                const travelTimeMinutes = travelTimeSeconds ? Math.round(travelTimeSeconds / 60) : '‚Äî';
                const lengthMeters = route.summary && route.summary.lengthInMeters ? Math.round(route.summary.lengthInMeters) : null;

                // –î–æ–¥–∞—î–º–æ –≤–ª–∞—Å—Ç–∏–≤—ñ—Å—Ç—å routeId –¥–æ –∫–æ–∂–Ω–æ–≥–æ feature –¥–ª—è —Å—Ç–∏–ª—ñ–∑–∞—Ü—ñ—ó
                data.forEach(feature => {
                    feature.properties = feature.properties || {};
                    feature.properties.routeId = routeId;
                });

                // –î–æ–¥–∞—î–º–æ –º–∞—Ä—à—Ä—É—Ç –¥–æ –¥–∂–µ—Ä–µ–ª–∞ –¥–∞–Ω–∏—Ö
                routeDataSource.add(data);

                // –ó–±–µ—Ä—ñ–≥–∞—î–º–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –¥–ª—è –ø–∞–Ω–µ–ª—ñ —ñ–Ω—Ñ–æ
                routeResults[routeId] = {
                    name: destinationName,
                    travelTimeSeconds: travelTimeSeconds,
                    travelTimeMinutes: travelTimeMinutes,
                    lengthMeters: lengthMeters,
                    geojson: data
                };

                // –û–Ω–æ–≤–ª—é—î–º–æ –ø–∞–Ω–µ–ª—å —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó
                updateInfoPanel();

                // –û–Ω–æ–≤–ª—é—î–º–æ —Å–ø–ª–∏–≤–∞—é—á–µ –≤—ñ–∫–Ω–æ –°—Ç–æ—É–Ω—Ö–µ–Ω–¥–∂–∞ ‚Äî –∞–∫—É—Ä–∞—Ç–Ω–æ –¥–æ–¥–∞—î–º–æ —Ç–µ–∫—Å—Ç
                const newContent = `\n<div style="padding: 5px; font-size: 14px;">\n    <b>–ú–∞—Ä—à—Ä—É—Ç –¥–æ ${destinationName}:</b><br>\n    –ü—Ä–∏–±–ª–∏–∑–Ω–∏–π —á–∞—Å –Ω–∞ –º–∞—à–∏–Ω—ñ: <span style="font-weight: bold; color: ${routeId === 'toLondon' ? 'red' : 'darkgreen'};">${travelTimeMinutes} —Ö–≤.</span>\n    ${lengthMeters ? '<br>–í—ñ–¥—Å—Ç–∞–Ω—å: ' + (Math.round(lengthMeters/1000*10)/10) + ' –∫–º.' : ''}\n</div>\n`;

                const currentContent = popup.getContent() || '';
                popup.setContent(currentContent + newContent);

                // –í—ñ–¥–∫—Ä–∏–≤–∞—î–º–æ –ø–æ–ø–∞–ø, —è–∫—â–æ –≤—ñ–Ω —â–µ –Ω–µ –≤—ñ–¥–∫—Ä–∏—Ç–∏–π
                if (!popup.isOpen()) popup.open(map);

                // –ü—ñ—Å–ª—è –¥–æ–¥–∞–≤–∞–Ω–Ω—è –º–∞—Ä—à—Ä—É—Ç—É ‚Äî –ø—Ä–∏–±–µ—Ä–µ–º–æ/–ø–æ–∫–∞–∂–µ–º–æ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–æ –¥–æ –≤–∏–¥–∏–º–æ—Å—Ç—ñ
                updateRoutesVisibility();

            })
            .catch(error => {
                console.error(`–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫—É –º–∞—Ä—à—Ä—É—Ç—É –¥–æ ${destinationName}:`, error);
                const errorContent = `<div style="padding: 5px; font-size: 14px; color: red;">–ü–æ–º–∏–ª–∫–∞ —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫—É –¥–æ ${destinationName}.</div>`;
                const currentContent = popup.getContent() || '';
                popup.setContent(currentContent + errorContent);
                updateInfoPanel();
            });
        }

        function updateInfoPanel() {
            const infoDiv = document.getElementById('routesInfo');
            let html = '';

            if (!routeResults.toAmesbury && !routeResults.toLondon) {
                html = '–ú–∞—Ä—à—Ä—É—Ç–∏ —â–µ –∑–∞–≤–∞–Ω—Ç–∞–∂—É—é—Ç—å—Å—è...';
            } else {
                Object.keys(routeResults).forEach(id => {
                    const r = routeResults[id];
                    if (!r) return;

                    const timeText = r.travelTimeMinutes !== '‚Äî' ? `${r.travelTimeMinutes} —Ö–≤.` : '‚Äî';
                    const distText = r.lengthMeters ? `${Math.round(r.lengthMeters/1000*10)/10} –∫–º` : '‚Äî';

                    html += `<div style="margin-top:6px; padding-bottom:6px; border-bottom: 1px solid #eee;">
                                <b style="color:${id==='toLondon'?'red':'darkgreen'}">${r.name}</b><br>
                                –ß–∞—Å: <strong>${timeText}</strong><br>
                                –í—ñ–¥—Å—Ç–∞–Ω—å: <strong>${distText}</strong>
                             </div>`;
                });
            }

            infoDiv.innerHTML = html;
        }

        // –°—Ö–æ–≤–∞/–ø–æ–∫–∞–∑ –º–∞—Ä—à—Ä—É—Ç—É –ø–æ routeId ‚Äî —Ñ—ñ–ª—å—Ç—Ä —É –¥–∂–µ—Ä–µ–ª—ñ –¥–∞–Ω–∏—Ö
        function updateRoutesVisibility() {
            // –°—Ç–≤–æ—Ä–∏–º–æ –Ω–æ–≤–∏–π –º–∞—Å–∏–≤ –∑ feature'—ñ–≤, —è–∫—ñ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—é—Ç—å –≤–∏–¥–∏–º–∏–º –º–∞—Ä—à—Ä—É—Ç–∞–º
            const allFeatures = routeDataSource.getShapes();

            // –Ø–∫—â–æ –Ω–µ–º–∞—î —Ñ—ñ—á ‚Äî –ø—Ä–æ—Å—Ç–æ –ø–æ–≤–µ—Ä–Ω–µ–º–æ—Å—è
            if (!allFeatures || allFeatures.length === 0) return;

            // –§—ñ–ª—å—Ç—Ä—É—î–º–æ –∑–∞ routeId
            const visibleFeatures = [];
            allFeatures.forEach(shape => {
                try {
                    const props = shape.properties || {};
                    const id = props.routeId;
                    if ((id === 'toAmesbury' && visibleRoutes.toAmesbury) || (id === 'toLondon' && visibleRoutes.toLondon)) {
                        visibleFeatures.push(shape);
                    }
                } catch (e) {
                    // –ø—Ä–æ–ø—É—Å–∫–∞—î–º–æ
                }
            });

            // –û–Ω–æ–≤–ª—é—î–º–æ –¥–∂–µ—Ä–µ–ª–æ: —Å–ø–æ—á–∞—Ç–∫—É –æ—á–∏—â—É—î–º–æ, –ø–æ—Ç—ñ–º –¥–æ–¥–∞—î–º–æ –≤–∏–¥–∏–º—ñ —Ñ—ñ—á—ñ
            routeDataSource.clear();
            if (visibleFeatures.length > 0) routeDataSource.add(visibleFeatures);
        }

    </script>
    
    <audio controls autoplay loop>
<source src="music-for-relax.mp3" type="audio/mpeg">
–í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø—ñ–¥—Ç—Ä–∏–º—É—î –∞—É–¥—ñ–æ.
</audio>
    
</body>

</html>
