<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <title>–ö–∞—Ä—Ç–∞ –°—Ç–æ—É–Ω—Ö–µ–Ω–¥–∂–∞ –Ω–∞ Azure Maps</title>

    <link rel="stylesheet" href="https://atlas.microsoft.com/sdk/javascript/mapcontrol/3/atlas.min.css" type="text/css" />
    <script src="https://atlas.microsoft.com/sdk/javascript/mapcontrol/3/atlas.min.js"></script>

    <script src="https://atlas.microsoft.com/sdk/javascript/service/2/atlas-service.min.js"></script>

    <style>
        /* –°—Ç–∏–ª—ñ –¥–ª—è –ø–æ–≤–Ω–æ–µ–∫—Ä–∞–Ω–Ω–æ—ó –∫–∞—Ä—Ç–∏ */
        html, body {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            font-family: Arial, sans-serif;
        }
        #myMap {
            width: 100%;
            height: 60vh; /* –ö–∞—Ä—Ç–∞ –∑–∞–π–º–∞—Ç–∏–º–µ 60% –≤–∏—Å–æ—Ç–∏ –≤—ñ–∫–Ω–∞ */
        }
        #panoContainer {
            width: 100%;
            height: 100vh; /* –ü–∞–Ω–æ—Ä–∞–º–∞ –∑–∞–π–º–∞—Ç–∏–º–µ 40% –≤–∏—Å–æ—Ç–∏ –≤—ñ–∫–Ω–∞ */
            border-top: 2px solid #ccc;
            box-sizing: border-box;
        }
        .container {
            padding: 10px;
        }
    </style>
</head>
<body onload="InitMap()">
    <h1>–°—Ç–æ—É–Ω—Ö–µ–Ω–¥–∂ —Ç–∞ –æ–∫–æ–ª–∏—Ü—ñ</h1>
    <div id="myMap"></div>
    
<div id="panoContainer">
        <h2>–ü–∞–Ω–æ—Ä–∞–º–Ω–∏–π –ø–µ—Ä–µ–≥–ª—è–¥ (Google Street View)</h2>
        <iframe
            width="100%"
            height="100%"
            frameborder="0" style="border:0"
            src="https://www.google.com/maps/embed?pb=!3m2!1suk!2sua!4v1761065304977!5m2!1suk!2sua!6m8!1m7!1sCAoSFkNJSE0wb2dLRUlDQWdJRG13b3FlUFE.!2m2!1d51.17843307511775!2d-1.826001340014652!3f357.315239888935!4f-21.49353908800488!5f0.7820865974627469" 
            allowfullscreen
            referrerpolicy="no-referrer-when-downgrade">
            
        </iframe>
    </div>

    <script>
        const subscriptionKey = '3pk8sSL7JavoYHPg12dqZD9501gAE1p6bCH81oCILxLLRtBERj0BJQQJ99BJACYeBjFpcYJpAAAgAZMP1mBn';
        let map;
        let datasource;
        let routeDataSource;

        function InitMap() {
            // –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏ –°—Ç–æ—É–Ω—Ö–µ–Ω–¥–∂–∞: [–¥–æ–≤–≥–æ—Ç–∞, —à–∏—Ä–æ—Ç–∞]
            const stonehengeCoords = [-1.8262, 51.1789];

            // 1. –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –∫–∞—Ä—Ç–∏ —Ç–∞ –∑–º—ñ–Ω–∞ —Å—Ç–∏–ª—é
            map = new atlas.Map('myMap', {
                center: stonehengeCoords, 
                zoom: 14,
                view: 'Auto',
                
                // –ó–º—ñ–Ω–∞ —Å—Ç–∏–ª—é –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è: 'road' (–¥–æ—Ä–æ–≥–∏), 'satellite' (—Å—É–ø—É—Ç–Ω–∏–∫), 
                // 'grayscale_dark', 'night' —Ç–∞ —ñ–Ω.
                style: 'satellite_road_labels', 

                authOptions: {
                    authType: 'subscriptionKey',
                    subscriptionKey: subscriptionKey
                }
            });

            // –û—á—ñ–∫—É–≤–∞–Ω–Ω—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ä–µ—Å—É—Ä—Å—ñ–≤ –∫–∞—Ä—Ç–∏
            map.events.add('ready', function () {
                
                // –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –¥–∂–µ—Ä–µ–ª–∞ –¥–∞–Ω–∏—Ö –¥–ª—è –º–∞—Ä–∫–µ—Ä—ñ–≤
                datasource = new atlas.source.DataSource();
                map.sources.add(datasource);

                // –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –¥–∂–µ—Ä–µ–ª–∞ –¥–∞–Ω–∏—Ö –¥–ª—è –º–∞—Ä—à—Ä—É—Ç—ñ–≤
                routeDataSource = new atlas.source.DataSource();
                map.sources.add(routeDataSource);


                // 2. –î–æ–¥–∞–≤–∞–Ω–Ω—è –º—ñ—Ç–æ–∫ (–º–∞—Ä–∫–µ—Ä—ñ–≤)
                addMarkers();

                // 3. –ü—Ä–æ–∫–ª–∞–¥–∞–Ω–Ω—è –º–∞—Ä—à—Ä—É—Ç—É
                calculateAndDisplayRoute();

                // 4. –î–æ–¥–∞—Ç–∫–æ–≤—ñ –µ–ª–µ–º–µ–Ω—Ç–∏ –∫–µ—Ä—É–≤–∞–Ω–Ω—è (–æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ)
                map.controls.add(new atlas.control.ZoomControl(), { position: 'top-right' });
                map.controls.add(new atlas.control.StyleControl({
                    mapStyles: ['road', 'grayscale_dark', 'satellite', 'satellite_road_labels']
                }), { position: 'top-right' });
                
            });
        }

        function addMarkers() {
            // –ú—ñ—Ç–∫–∞ 1: –°—Ç–æ—É–Ω—Ö–µ–Ω–¥–∂
            const marker1 = new atlas.HtmlMarker({
                color: 'red',
                text: 'üóø', // –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è Emoji —è–∫ —Ç–µ–∫—Å—Ç—É –º—ñ—Ç–∫–∏
                position: [-1.8262, 51.1789],
                popup: new atlas.Popup({
                    content: '<div style="padding:10px;"><b>–°—Ç–æ—É–Ω—Ö–µ–Ω–¥–∂</b><br>–°—Ç–∞—Ä–æ–¥–∞–≤–Ω—ñ–π –ø–∞–º\'—è—Ç–Ω–∏–∫</div>',
                    pixelOffset: [0, -30]
                })
            });
            map.markers.add(marker1);
            
            // –í—ñ–¥–∫—Ä–∏—Ç—Ç—è —Å–ø–ª–∏–≤–∞—é—á–æ–≥–æ –≤—ñ–∫–Ω–∞ –ø—Ä–∏ –Ω–∞—Ç–∏—Å–∫–∞–Ω–Ω—ñ
            map.events.add('click', marker1, () => {
                marker1.getPopup().toggle();
            });

            // –ú—ñ—Ç–∫–∞ 2: –¢—É—Ä–∏—Å—Ç–∏—á–Ω–∏–π —Ü–µ–Ω—Ç—Ä
            const marker2 = new atlas.HtmlMarker({
                color: 'blue',
                text: 'i',
                position: [-1.8415, 51.1770],
                popup: new atlas.Popup({
                    content: '<div style="padding:10px;"><b>–¢—É—Ä–∏—Å—Ç–∏—á–Ω–∏–π —Ü–µ–Ω—Ç—Ä</b></div>'
                })
            });
            map.markers.add(marker2);
             map.events.add('click', marker2, () => {
                marker2.getPopup().toggle();
            });
        }

        function calculateAndDisplayRoute() {
            // –í–∏–∑–Ω–∞—á–µ–Ω–Ω—è –ø–æ—á–∞—Ç–∫–æ–≤–æ—ó —Ç–∞ –∫—ñ–Ω—Ü–µ–≤–æ—ó —Ç–æ—á–æ–∫ –º–∞—Ä—à—Ä—É—Ç—É
            // –¢–æ—á–∫–∞ –ê: –¢—É—Ä–∏—Å—Ç–∏—á–Ω–∏–π —Ü–µ–Ω—Ç—Ä
            const startPoint = [-1.8415, 51.1770]; 
            // –¢–æ—á–∫–∞ –ë: –°—Ç–æ—É–Ω—Ö–µ–Ω–¥–∂
            const endPoint = [-1.8262, 51.1789];

            // –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –æ–±'—î–∫—Ç–∞ —Å–µ—Ä–≤—ñ—Å—É –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü—ñ—ó
            const routeURL = 'https://atlas.microsoft.com/route/directions/json?api-version=1.0';
            const routeService = new atlas.service.RouteURL(new atlas.service.Aborter(), routeURL);

            // –ü–∞—Ä–∞–º–µ—Ç—Ä–∏ –º–∞—Ä—à—Ä—É—Ç—É
            const coordinates = [startPoint, endPoint];

            routeService.calculateRouteDirections(atlas.service.Aborter.timeout(10000), coordinates)
                .then(response => {
                    const data = response.geojson.features;
                    
                    // –î–æ–¥–∞–≤–∞–Ω–Ω—è GeoJSON –º–∞—Ä—à—Ä—É—Ç—É –¥–æ –¥–∂–µ—Ä–µ–ª–∞ –¥–∞–Ω–∏—Ö
                    routeDataSource.add(data);

                    // –°—Ç–≤–æ—Ä–µ–Ω–Ω—è —à–∞—Ä—É –ª—ñ–Ω—ñ—ó –¥–ª—è –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –º–∞—Ä—à—Ä—É—Ç—É
                    const routeLayer = new atlas.layer.LineLayer(routeDataSource, null, {
                        strokeColor: 'darkgreen',
                        strokeWidth: 5,
                        lineJoin: 'round',
                        lineCap: 'round'
                    });

                    // –î–æ–¥–∞–≤–∞–Ω–Ω—è —à–∞—Ä—É –º–∞—Ä—à—Ä—É—Ç—É –Ω–∞ –∫–∞—Ä—Ç—É
                    map.layers.add(routeLayer);

                    // –ú–∞—Å—à—Ç–∞–±—É–≤–∞–Ω–Ω—è –∫–∞—Ä—Ç–∏ –¥–æ –º–∞—Ä—à—Ä—É—Ç—É (–æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ)
                    const bounds = atlas.data.BoundingBox.fromData(data);
                    map.setCamera({ bounds: bounds, padding: 50 });
                })
                .catch(error => {
                    console.error("–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫—É –º–∞—Ä—à—Ä—É—Ç—É:", error);
                });
        }
    </script>
</body>
</html>
